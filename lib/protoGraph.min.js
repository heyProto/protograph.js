function UUID(){}var define,requireModule;"function"!=typeof define&&"function"!=typeof requireModule&&function(){var e={},t={};requireModule=function(n){if(t[n])return t[n];var r=e[n];if(!r)throw new Error("Module: '"+n+"' not found.");for(var i,o=r.deps,s=r.callback,a=[],u=0,c=o.length;c>u;u++)"exports"===o[u]?a.push(i={}):a.push(requireModule(o[u]));var l=s.apply(this,a);return t[n]=i||l},(define=function(t,n,r){e[t]={deps:n,callback:r}}).registry=e,define.seen=t}();(function(){"use strict";function e(e,t){for(var n=0,r=e.length;r>n;n++)if(e[n]===t)return n;return-1}function t(e){var t=e._promiseCallbacks;return t||(t=e._promiseCallbacks={}),t}function n(e,t){return"onerror"===e?void T.on("error",t):2!==arguments.length?T[e]:void(T[e]=t)}function r(e){return"function"==typeof e}function i(){}function o(){}function s(e,t){if(t.constructor===e.constructor)u=e,d=t,d._state===U?c(u,d._result):u._state===N?l(u,d._result):f(d,void 0,function(e){d!==e?a(u,e):c(u,e)},function(e){l(u,e)});else{var n=function(e){try{return e.then}catch(e){return q.error=e,q}}(t);n===q?l(e,q.error):void 0===n?c(e,t):r(n)?(i=e,o=t,s=n,T.async(function(e){var t=!1,n=function(e,t,n,r){try{e.call(t,n,r)}catch(e){return e}}(s,o,function(n){t||(t=!0,o!==n?a(e,n):c(e,n))},function(n){t||(t=!0,l(e,n))},e._label);!t&&n&&(t=!0,l(e,n))},i)):c(e,t)}var i,o,s,u,d}function a(e,t){var n;e===t?c(e,t):"function"==typeof(n=t)||"object"==typeof n&&null!==n?s(e,t):c(e,t)}function u(e){e._onerror&&e._onerror(e._result),d(e)}function c(e,t){e._state===L&&(e._result=t,e._state=U,0===e._subscribers.length?T.instrument&&I("fulfilled",e):T.async(d,e))}function l(e,t){e._state===L&&(e._state=N,e._result=t,T.async(u,e))}function f(e,t,n,r){var i=e._subscribers,o=i.length;e._onerror=null,i[o]=t,i[o+U]=n,i[o+N]=r,0===o&&e._state&&T.async(d,e)}function d(e){var t=e._subscribers,n=e._state;if(T.instrument&&I(n===U?"fulfilled":"rejected",e),0!==t.length){for(var r,i,o=e._result,s=0;s<t.length;s+=3)r=t[s],i=t[s+n],r?h(n,r,i,o):i(o);e._subscribers.length=0}}function p(){this.error=null}function h(e,t,n,i){var o,s,u,f,d=r(n);if(d){if((o=function(e,t){try{return e(t)}catch(e){return z.error=e,z}}(n,i))===z?(f=!0,s=o.error,o=null):u=!0,t===o)return void l(t,new TypeError("A promises callback cannot return that same promise."))}else o=i,u=!0;t._state!==L||(d&&u?a(t,o):f?l(t,s):e===U?c(t,o):e===N&&l(t,o))}function g(e,t,n){return e===U?{state:"fulfilled",value:n}:{state:"rejected",reason:n}}function v(e,t,n,r){this._instanceConstructor=e,this.promise=new e(o,r),this._abortOnReject=n,this._validateInput(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._init(),0===this.length?c(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&c(this.promise,this._result))):l(this.promise,this._validationError())}function m(e,t){this._id=W++,this._label=t,this._state=void 0,this._result=void 0,this._subscribers=[],T.instrument&&I("created",this),o!==e&&(r(e)||function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof m||function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}(),function(e,t){try{t(function(t){a(e,t)},function(t){l(e,t)})}catch(t){l(e,t)}}(this,e))}function y(){this.value=void 0}function b(e,t,n){try{e.apply(t,n)}catch(e){return K.value=e,K}}function _(e,t){return{then:function(n,r){return e.call(t,n,r)}}}function w(e){return!(!e||"object"!=typeof e)&&(e.constructor===F||function(e){try{return e.then}catch(e){return K.value=e,K}}(e))}function x(e,t,n){this._superConstructor(e,t,!1,n)}function E(e,t,n){this._superConstructor(e,t,!0,n)}function C(e,t,n){this._superConstructor(e,t,!1,n)}function P(){for(var e=0;$>e;e+=2){(0,ne[e])(ne[e+1]),ne[e]=void 0,ne[e+1]=void 0}$=0}function S(){T.on.apply(T,arguments)}var M={mixin:function(e){return e.on=this.on,e.off=this.off,e.trigger=this.trigger,e._promiseCallbacks=void 0,e},on:function(n,r){var i,o=t(this);(i=o[n])||(i=o[n]=[]),-1===e(i,r)&&i.push(r)},off:function(n,r){var i,o,s=t(this);return r?void(-1!==(o=e(i=s[n],r))&&i.splice(o,1)):void(s[n]=[])},trigger:function(e,n){var r;if(r=t(this)[e])for(var i=0;i<r.length;i++)(0,r[i])(n)}},T={instrument:!1};M.mixin(T);var O=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},k=Date.now||function(){return(new Date).getTime()},j=Object.create||function(e){if(arguments.length>1)throw new Error("Second argument not supported");if("object"!=typeof e)throw new TypeError("Argument must be an object");return i.prototype=e,new i},A=[],I=function(e,t,n){1===A.push({name:e,payload:{guid:t._guidKey+t._id,eventName:e,detail:t._result,childGuid:n&&t._guidKey+n._id,label:t._label,timeStamp:k(),stack:new Error(t._label).stack}})&&setTimeout(function(){for(var e,t=0;t<A.length;t++)e=A[t],T.trigger(e.name,e.payload);A.length=0},50)},L=void 0,U=1,N=2,q=new p,z=new p;v.prototype._validateInput=function(e){return O(e)},v.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},v.prototype._init=function(){this._result=new Array(this.length)};var D=v;v.prototype._enumerate=function(){for(var e=this.length,t=this.promise,n=this._input,r=0;t._state===L&&e>r;r++)this._eachEntry(n[r],r)},v.prototype._eachEntry=function(e,t){var n,r=this._instanceConstructor;"object"==typeof(n=e)&&null!==n?e.constructor===r&&e._state!==L?(e._onerror=null,this._settledAt(e._state,t,e._result)):this._willSettleAt(r.resolve(e),t):(this._remaining--,this._result[t]=this._makeResult(U,t,e))},v.prototype._settledAt=function(e,t,n){var r=this.promise;r._state===L&&(this._remaining--,this._abortOnReject&&e===N?l(r,n):this._result[t]=this._makeResult(e,t,n)),0===this._remaining&&c(r,this._result)},v.prototype._makeResult=function(e,t,n){return n},v.prototype._willSettleAt=function(e,t){var n=this;f(e,void 0,function(e){n._settledAt(U,t,e)},function(e){n._settledAt(N,t,e)})};var R=function(e,t){if(e&&"object"==typeof e&&e.constructor===this)return e;var n=new this(o,t);return a(n,e),n},H="rsvp_"+k()+"-",W=0,F=m;m.cast=R,m.all=function(e,t){return new D(this,e,!0,t).promise},m.race=function(e,t){function n(e){a(i,e)}function r(e){l(i,e)}var i=new this(o,t);if(!O(e))return l(i,new TypeError("You must pass an array to race.")),i;for(var s=e.length,u=0;i._state===L&&s>u;u++)f(this.resolve(e[u]),void 0,n,r);return i},m.resolve=R,m.reject=function(e,t){var n=new this(o,t);return l(n,e),n},m.prototype={constructor:m,_guidKey:H,_onerror:function(e){T.trigger("error",e)},then:function(e,t,n){var r=this,i=r._state;if(i===U&&!e||i===N&&!t)return T.instrument&&I("chained",this,this),this;r._onerror=null;var s=new this.constructor(o,n),a=r._result;if(T.instrument&&I("chained",r,s),i){var u=arguments[i-1];T.async(function(){h(i,s,u,a)})}else f(r,s,e,t);return s},catch:function(e,t){return this.then(null,e,t)},finally:function(e,t){var n=this.constructor;return this.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){throw t})},t)}};var K=new y,Q=new y;x.prototype=j(D.prototype),x.prototype._superConstructor=D,x.prototype._makeResult=g,x.prototype._validationError=function(){return new Error("allSettled must be called with an array")};var Y=E;E.prototype=j(D.prototype),E.prototype._superConstructor=D,E.prototype._init=function(){this._result={}},E.prototype._validateInput=function(e){return e&&"object"==typeof e},E.prototype._validationError=function(){return new Error("Promise.hash must be called with an object")},E.prototype._enumerate=function(){var e=this.promise,t=this._input,n=[];for(var r in t)e._state===L&&t.hasOwnProperty(r)&&n.push({position:r,entry:t[r]});var i=n.length;this._remaining=i;for(var o,s=0;e._state===L&&i>s;s++)o=n[s],this._eachEntry(o.entry,o.position)};C.prototype=j(Y.prototype),C.prototype._superConstructor=D,C.prototype._makeResult=g,C.prototype._validationError=function(){return new Error("hashSettled must be called with an object")};var V,B,X,J,G,$=0,Z="undefined"!=typeof window?window:{},ee=Z.MutationObserver||Z.WebKitMutationObserver,te="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,ne=new Array(1e3);if(V="undefined"!=typeof process&&"[object process]"==={}.toString.call(process)?function(){process.nextTick(P)}:ee?(X=0,J=new ee(P),G=document.createTextNode(""),J.observe(G,{characterData:!0}),function(){G.data=X=++X%2}):te?((B=new MessageChannel).port1.onmessage=P,function(){B.port2.postMessage(0)}):function(){setTimeout(P,1)},T.async=function(e,t){ne[$]=e,ne[$+1]=t,2===($+=2)&&V()},"undefined"!=typeof window&&"object"==typeof window.__PROMISE_INSTRUMENTATION__){var re=window.__PROMISE_INSTRUMENTATION__;n("instrument",!0);for(var ie in re)re.hasOwnProperty(ie)&&S(ie,re[ie])}var oe={race:function(e,t){return F.race(e,t)},Promise:F,allSettled:function(e,t){return new x(F,e,t).promise},hash:function(e,t){return new Y(F,e,t).promise},hashSettled:function(e,t){return new C(F,e,t).promise},denodeify:function(e,t){var n=function(){for(var n,r=arguments.length,i=new Array(r+1),s=!1,u=0;r>u;++u){if(n=arguments[u],!s){if((s=w(n))===Q){var c=new F(o);return l(c,Q.value),c}s&&!0!==s&&(n=_(s,n))}i[u]=n}var f,d,p,h,g,v,m=new F(o);return i[r]=function(e,n){e?l(m,e):void 0===t?a(m,n):!0===t?a(m,function(e){for(var t=e.length,n=new Array(t-1),r=1;t>r;r++)n[r-1]=e[r];return n}(arguments)):O(t)?a(m,function(e,t){for(var n,r,i={},o=e.length,s=new Array(o),a=0;o>a;a++)s[a]=e[a];for(r=0;r<t.length;r++)n=t[r],i[n]=s[r+1];return i}(arguments,t)):a(m,n)},s?(p=m,h=i,g=e,v=this,F.all(h).then(function(e){var t=b(g,v,e);return t===K&&l(p,t.value),p})):(f=m,(d=b(e,this,i))===K&&l(f,d.value),f)};return n.__proto__=e,n},on:S,off:function(){T.off.apply(T,arguments)},map:function(e,t,n){return F.all(e,n).then(function(e){if(!r(t))throw new TypeError("You must pass a function as map's second argument.");for(var i=e.length,o=new Array(i),s=0;i>s;s++)o[s]=t(e[s]);return F.all(o,n)})},filter:function(e,t,n){return F.all(e,n).then(function(e){if(!r(t))throw new TypeError("You must pass a function as filter's second argument.");for(var i=e.length,o=new Array(i),s=0;i>s;s++)o[s]=t(e[s]);return F.all(o,n).then(function(t){for(var n=new Array(i),r=0,o=0;i>o;o++)t[o]&&(n[r]=e[o],r++);return n.length=r,n})})},resolve:function(e,t){return F.resolve(e,t)},reject:function(e,t){return F.reject(e,t)},all:function(e,t){return F.all(e,t)},rethrow:function(e){throw setTimeout(function(){throw e}),e},defer:function(e){var t={};return t.promise=new F(function(e,n){t.resolve=e,t.reject=n},e),t},EventTarget:M,configure:n,async:function(e,t){T.async(e,t)}};"function"==typeof define&&define.amd?define(function(){return oe}):"undefined"!=typeof module&&module.exports?module.exports=oe:void 0!==this&&(this.RSVP=oe)}).call(this),define("rsvp",[],function(){return RSVP}),UUID.generate=function(){var e=UUID._gri,t=UUID._ha;return t(e(32),8)+"-"+t(e(16),4)+"-"+t(16384|e(12),4)+"-"+t(32768|e(14),4)+"-"+t(e(48),12)},UUID._gri=function(e){return 0>e?NaN:30>=e?0|Math.random()*(1<<e):53>=e?(0|1073741824*Math.random())+1073741824*(0|Math.random()*(1<<e-30)):NaN},UUID._ha=function(e,t){for(var n=e.toString(16),r=t-n.length,i="0";r>0;r>>>=1,i+=i)1&r&&(n=i+n);return n},function(e){var t,n,r,i={}.toString;Kamino={},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=Kamino),exports.Kamino=Kamino):e.Kamino=Kamino,Kamino.VERSION="0.1.0",KaminoException=function(){this.name="KaminoException",this.number=25,this.message="Uncaught Error: DATA_CLONE_ERR: Kamino Exception 25"};var o=new Date(-0xc782b5b800cec);try{o=-109252==o.getUTCFullYear()&&0===o.getUTCMonth()&&1==o.getUTCDate()&&10==o.getUTCHours()&&37==o.getUTCMinutes()&&6==o.getUTCSeconds()&&708==o.getUTCMilliseconds()}catch(e){}var s="A"!="A"[0];o||Math.floor,(t={}.hasOwnProperty)||(t=function(e){var n,r={};return(r.__proto__=null,r.__proto__={toString:1},r).toString!=i?t=function(e){var t=this.__proto__,n=e in(this.__proto__=null,this);return this.__proto__=t,n}:(n=r.constructor,t=function(e){var t=(this.constructor||n).prototype;return e in this&&!(e in t&&this[e]===t[e])}),r=null,t.call(this,e)}),n=function(e,n){var r,o,s,a,u=0;(r=function(){this.valueOf=0}).prototype.valueOf=0,o=new r;for(s in o)t.call(o,s)&&u++;return r=o=null,u?a=2==u?function(e,n){var r,o={},s="[object Function]"==i.call(e);for(r in e)s&&"prototype"==r||t.call(o,r)||!(o[r]=1)||!t.call(e,r)||n(r)}:function(e,n){var r,o,s="[object Function]"==i.call(e);for(r in e)s&&"prototype"==r||!t.call(e,r)||(o="constructor"===r)||n(r);(o||t.call(e,r="constructor"))&&n(r)}:(o=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],a=function(e,n){var r,s,a="[object Function]"==i.call(e);for(r in e)a&&"prototype"==r||!t.call(e,r)||n(r);for(s=o.length;r=o[--s];t.call(e,r)&&n(r));}),a(e,n)};var a={"\\":"\\\\",'"':'\\"',"\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","  ":"\\t"},u=function(e){for(var t,n='"',r=0;t=e.charAt(r);r++)n+='\\"\b\f\n\r '.indexOf(t)>-1?a[t]:a[t]=" ">t?"\\u00"+(i=2,o=t.charCodeAt(0).toString(16),("000000"+(o||0)).slice(-i)):t;var i,o;return n+'"'},c=function(e,o,a,l,f,d,p){var h,g,v,m,y,b,_,w,x,E,C,P=o[e],S="";if(P instanceof Error||P instanceof Function)throw new KaminoException;if(C=P,"object"==typeof HTMLElement?C instanceof HTMLElement:C&&"object"==typeof C&&1===C.nodeType&&"string"==typeof C.nodeName)throw new KaminoException;if("object"==typeof P&&P&&("[object Date]"!=(h=i.call(P))||t.call(P,"toJSON")?"function"==typeof P.toJSON&&("[object Number]"!=h&&"[object String]"!=h&&"[object Array]"!=h||t.call(P,"toJSON"))&&(P=P.toJSON(e)):P=P>-1/0&&1/0>P?P.toUTCString().replace("GMT","UTC"):null),a&&(P=a.call(o,e,P)),null===P)return"null";if(void 0!==P){if("[object Boolean]"==(g=i.call(P)))return""+P;if("[object Number]"==g)return P===Number.POSITIVE_INFINITY?"Infinity":P===Number.NEGATIVE_INFINITY?"NInfinity":isNaN(P)?"NaN":""+P;if("[object RegExp]"==g)return E=P.source,S+=P.ignoreCase?"i":"",S+=P.global?"g":"",S+=P.multiline?"m":"",E=u(s?E.split(""):E),S=u(s?S.split(""):S),P="^"+E+S;if("[object String]"==g)return P=u(s?P.split(""):P),"[object Date]"==h&&(P="%"+P),P;if("object"==typeof P){for(b=p.length;b--;)if(p[b]===P)return"&"+b;if(p.push(P),v=[],_=d,d+=f,"[object Array]"==g){for(y=0,b=P.length;b>y;w||(w=!0),y++)m=c(y,P,a,l,f,d,p),v.push(m===r?"null":m);x=w?f?"[\n"+d+v.join(",\n"+d)+"\n"+_+"]":"["+v.join(",")+"]":"[]"}else n(l||P,function(e){var t=c(e,P,a,l,f,d,p);t!==r&&v.push(u(s?e.split(""):e)+":"+(f?" ":"")+t),w||(w=!0)}),x=w?f?"{\n"+d+v.join(",\n"+d)+"\n"+_+"}":"{"+v.join(",")+"}":"{}";return x}}};Kamino.stringify=function(e,t,n){var r,o,s;if("function"==typeof t||"object"==typeof t&&t)if("[object Function]"==i.call(t))o=t;else if("[object Array]"==i.call(t)){s={};for(var a,u=0,l=t.length;l>u;a=t[u++],("[object String]"==i.call(a)||"[object Number]"==i.call(a))&&(s[a]=1));}if(n)if("[object Number]"==i.call(n)){if((n-=n%1)>0)for(r="",n>10&&(n=10);r.length<n;r+=" ");}else"[object String]"==i.call(n)&&(r=n.length<=10?n:n.slice(0,10));return c("",((a={})[""]=e,a),o,s,r,"",[])};var l,f,d,p=String.fromCharCode,h={"\\":"\\",'"':'"',"/":"/",b:"\b",t:"    ",n:"\n",f:"\f",r:"\r"},g=function(){throw l=f=null,SyntaxError()},v=function(e){e=e||"";var t,n,r,i,o=f,s=o.length;for(t=e,l++;s>l;)if(n=o[l]," ">n)g();else if("\\"==n)if(n=o[++l],'\\"/btnfr'.indexOf(n)>-1)t+=h[n],l++;else if("u"==n){for(r=++l,i=l+4;i>l;l++)n=o[l],n>="0"&&"9">=n||n>="a"&&"f">=n||n>="A"&&"F">=n||g();t+=p("0x"+o.slice(r,l))}else g();else{if('"'==n)break;t+=n,l++}return'"'==o[l]?(l++,t):void g()},m=function(){for(var e,t,n,r,i,o,s,a=f,u=a.length;u>l;)if(e=a[l],"   \r\n ".indexOf(e)>-1)l++;else{if("{}[]:,".indexOf(e)>-1)return l++,e;if('"'==e)return v("@");if("%"==e){if('"'==(e=a[++l]))return i=v(),new Date(i);g()}else if("^"==e){if('"'==(e=a[++l])&&(o=v(),'"'==(e=a[l])))return s=v(),new RegExp(o,s);g()}else if("&"==e){if((e=a[++l])>="0"&&"9">=e)return l++,d[e];g()}else{if(t=l,"-"==e&&(r=!0,e=a[++l]),e>="0"&&"9">=e){for("0"==e&&((e=a[l+1])>="0"&&"9">=e)&&g(),r=!1;u>l&&((e=a[l])>="0"&&"9">=e);l++);if("."==a[l]){for(n=++l;u>n&&((e=a[n])>="0"&&"9">=e);n++);n==l&&g(),l=n}if("e"==(e=a[l])||"E"==e){for(("+"==(e=a[++l])||"-"==e)&&l++,n=l;u>n&&((e=a[n])>="0"&&"9">=e);n++);n==l&&g(),l=n}return+a.slice(t,l)}if(r&&g(),"true"==a.slice(l,l+4))return l+=4,!0;if("false"==a.slice(l,l+5))return l+=5,!1;if("Infinity"==a.slice(l,l+8))return l+=8,1/0;if("NInfinity"==a.slice(l,l+9))return l+=9,-1/0;if("NaN"==a.slice(l,l+3))return l+=3,NaN;if("null"==a.slice(l,l+4))return l+=4,null;g()}}return"$"},y=function(e){var t,n;if("$"==e&&g(),"string"==typeof e){if("@"==e[0])return e.slice(1);if("["==e){for(t=[],d[d.length]=t;"]"!=(e=m());n||(n=!0))n&&(","==e?(e=m(),"]"==e&&g()):g()),","==e&&g(),t.push(y("string"==typeof e&&s?e.split(""):e));return t}if("{"==e){for(t={},d[d.length]=t;"}"!=(e=m());n||(n=!0)){n&&(","==e?"}"==(e=m())&&g():g()),(","==e||"string"!=typeof e||"@"!=e[0]||":"!=m())&&g();var r=m();t[e.slice(1)]=y("string"==typeof r&&s?r.split(""):r)}return t}g()}return e},b=function(e,t,n){var i=_(e,t,n);i===r?delete e[t]:e[t]=i},_=function(e,t,r){var o,s=e[t];if("object"==typeof s&&s)if("[object Array]"==i.call(s))for(o=s.length;o--;)b(s,o,r);else n(s,function(e){b(s,e,r)});return r.call(e,t,s)};Kamino.parse=function(e,t){var n,r;return l=0,f=""+e,d=[],s&&(f=e.split("")),n=y(m()),"$"!=m()&&g(),l=f=null,t&&"[object Function]"==i.call(t)?_(((r={})[""]=n,r),"",t):n},Kamino.clone=function(e){return Kamino.parse(Kamino.stringify(e))}}(this),function(e){var t,n=e,r=n.Window,i=[].slice;if(n.MessageChannel)r?r.postMessage=function(e,t,n,r){r=r||[],e.postMessage(t,n,r)}:n.Worker={postMessage:function(e,t,n){e.postMessage(t,n)}},n.Worker&&(n.Worker.postMessage=function(e,t,n){e.postMessage(t,n)});else{var o=function(e){return"undefined"!=typeof window&&n instanceof r&&!((t=n.Worker)&&"[object Function]"===Object.prototype.toString.call(t)&&e instanceof Worker);var t},s=function(e){if(c.verbose){var t=i.apply(arguments);t.unshift("MCNP: "),console.log.apply(console,t)}},a={},u=n.MessagePort=function(e){this._entangledPortUuid=null,this.destinationUrl=null,this._listeners={},this._messageQueue=[],this._messageQueueEnabled=!1,this._currentTarget=null,this.uuid=e||UUID.generate(),a[this.uuid]=this,this.log("created")};u.prototype={start:function(){var e,t=this;setTimeout(function(){for(t.log("draining "+t._messageQueue.length+" queued messages");t._messageQueueEnabled&&(e=t._messageQueue.shift());)t.dispatchEvent(e)}),this._messageQueueEnabled=!0,this.log("started")},close:function(){this._messageQueueEnabled=!1,this._entangledPortUuid&&(this._getEntangledPort()._entangledPortUuid=null,this._entangledPortUuid=null)},postMessage:function(e){var t,n=this._getEntangledPort(),r=this._currentTarget;return n?void(r?(t=c.encodeEvent(e,[n],!0),o(r)?(this.log("posting message from window to window",e,this.destinationUrl),r.postMessage(t,this.destinationUrl)):(this.log("posting message from or to worker",e),r.postMessage(t))):(this.log("not connected, queueing message",e),n._enqueueEvent(c._messageEvent(e,[n],!0)))):void this.log("not entangled, discarding message",e)},addEventListener:function(e,t){void 0===this._listeners[e]&&(this._listeners[e]=[]),this._listeners[e].push(t)},removeEventListener:function(e,t){if(this._listeners[e]instanceof Array)for(var n=this._listeners[e],r=0;r<n.length;r++)if(n[r]===t){n.splice(r,1);break}},dispatchEvent:function(e){var t=this._listeners.message;if(t)for(var n=0;n<t.length;n++)t[n].call(this,e)},_enqueueEvent:function(e){this._messageQueueEnabled?this.dispatchEvent(e):this._messageQueue.push(e)},_getPort:function(e,t,r){var i,o=(i=e.uuid,a[i]||c._createPort(i));if(o._entangledPortUuid=e._entangledPortUuid,o._getEntangledPort()._entangledPortUuid=o.uuid,o._currentTarget=t.source||t.currentTarget||n,"null"===t.origin?o.destinationUrl="*":o.destinationUrl=t.origin,r)for(var s=0;s<e._messageQueue.length;s++)o._messageQueue.push(e._messageQueue[s]);return o},_getEntangledPort:function(){return this._entangledPortUuid?a[this._entangledPortUuid]||c._createPort(this._entangledPortUuid):null},log:function(){if(c.verbose){var e=i.apply(arguments);e.unshift("Port",this.uuid),s.apply(null,e)}}};var c=n.MessageChannel=function(){var e,t=c._createPort(),n=c._createPort();return t._entangledPortUuid=n.uuid,n._entangledPortUuid=t.uuid,e={port1:t,port2:n},c.log(e,"created"),e};c.log=function(e){if(c.verbose){var t=["Chnl"],n=i.call(arguments,1);e.port1&&e.port2?t.push(e.port1.uuid,e.port2.uuid):e.forEach(function(e){t.push(e._entangledPortUuid)}),t.push.apply(t,n),s.apply(null,t)}},c._createPort=function(){var e=arguments,t=function(){return u.apply(this,e)};return t.prototype=u.prototype,new t},c.encodeEvent=function(e,t,n){for(var r,i=new Array(t.length),o=0;o<t.length;++o)i[o]=c._strippedPort(t[o]);return r={event:c._messageEvent(e,i,n)},Kamino.stringify(r)},c._messageEvent=function(e,t,n){return{data:e,ports:t,messageChannel:n}},c._strippedPort=function(e){if(e){for(var t,n,r,i=[],o=0;o<e._messageQueue.length;++o){n=(t=e._messageQueue[o]).ports||[],r=[];for(var s,a=0;a<n.length;++a)s=n[a],r.push({uuid:s.uuid,_entangledPortUuid:s._entangledPortUuid});i.push({data:t.data,messageChannel:t.messageChannel,ports:r})}return{uuid:e.uuid,_entangledPortUuid:e._entangledPortUuid,_messageQueue:i}}},c.decodeEvent=function(e,t){var n={data:null,ports:[]},r=Kamino.parse(e.data).event,i=r.ports;if(r){if(i)for(var o=0;o<i.length;o++)n.ports.push(u.prototype._getPort(i[o],e,t));n.data=r.data,n.source=e.source,n.messageChannel=r.messageChannel}return n};var l=function(e,t){var n;try{n=c.decodeEvent(e,t)}catch(t){if(!(t instanceof SyntaxError))throw t;n=e}return n},f=function(e){var t=l(e,!0);t.messageChannel&&c.propagateEvent(t)},d=function(e){var t,n,r,i,o;e.addEventListener?(n="addEventListener",i="removeEventListener",o="message"):e.attachEvent&&(n="attachEvent",i="detachEvent",o="onmessage"),t=e[n],r=e[i],e[n]=function(){var e,n=Array.prototype.slice.call(arguments),r=n[1],i=this;n[0]===o&&(e=function(e){var t=l(e);t.messageChannel||r.call(i,t)},r.messageHandlerWrapper=e,n[1]=e),t.apply(this,n)},e[i]=function(){var e=Array.prototype.slice.call(arguments),t=e[1];e[0]===o&&(e[1]=t.messageHandlerWrapper,delete t.messageHandlerWrapper),e[1]&&r.apply(this,e)}};if(c.propagateEvent=function(e){var t,n,r;if(e.messageChannel){t=e.ports;for(var i=0;i<t.length;i++)n=t[i],r=n._getEntangledPort(),n._currentTarget&&r._currentTarget?r.postMessage(e.data):n._enqueueEvent(e)}},c.reset=function(){a={}},(t=n).addEventListener?t.addEventListener("message",f,!1):t.attachEvent&&t.attachEvent("onmessage",f),r){var p;if(r.postMessage=function(e,t,n,r){var i,o;if(r=r||[],i=c.encodeEvent(t,r,!1),r)for(var s=0;s<r.length;s++)o=r[s]._getEntangledPort(),o._currentTarget||(o._currentTarget=e,o.destinationUrl=n);c.log(r,"handshake window",e),e.postMessage(i,n)},window.addEventListener)p=window;else{if(!window.attachEvent)throw"We couldn't find a method to attach an event handler.";p=r.prototype}d(p)}else d(n);if(n.Worker){var h,g=Worker;g.prototype.addEventListener?h=g.prototype.addEventListener:g.prototype.attachEvent&&(h=g.prototype.attachEvent),n.Worker=function(){var e=new g(arguments[0]);return h.call(e,"message",f),e},Worker.prototype=g.prototype,d(Worker.prototype)}else"undefined"==typeof Worker&&void 0===r&&(n.Worker={});n.Worker&&(n.Worker.postMessage=function(e,t,n){for(var r,i=c.encodeEvent(t,n,!1),o=0;o<n.length;o++)r=n[o]._getEntangledPort(),r._currentTarget=e;c.log(n,"handshake worker",e),e.postMessage(i)})}}(this),define("oasis",["oasis/util","oasis/xhr","oasis/connect","rsvp","oasis/logger","oasis/version","oasis/config","oasis/sandbox","oasis/sandbox_init","oasis/events","oasis/service","oasis/iframe_adapter","oasis/webworker_adapter","oasis/inline_adapter"],function(e,t,n,r,i,o,s,a,u,c,l,f,d,p){"use strict";function h(){this.packages={},this.requestId=0,this.oasisId="oasis"+ +new Date,this.consumers={},this.services=[],this.ports={},this.handlers={},this.receivedPorts=!1,this.configuration=new s,this.events=new c,this.didCreate()}var g=e.assert,v=e.delegate,m=t.xhr,y=n.connect,b=n.connectCapabilities,_=n.portFor;return h.Version=o,h.Service=h.Consumer=l,h.RSVP=r,h.reset=function(){h.adapters={iframe:new f,webworker:new d,inline:new p}},h.reset(),h.prototype={logger:i,log:function(){this.logger.log.apply(this.logger,arguments)},on:v("events","on"),off:v("events","off"),trigger:v("events","trigger"),didCreate:function(){},xhr:m,createSandbox:function(e){return new a(this,e)},register:function(e){g(e.capabilities,"You are trying to register a package without any capabilities. Please provide a list of requested capabilities, or an empty array ([])."),this.packages[e.url]=e},configure:function(e,t){this.configuration[e]=t},autoInitializeSandbox:u,connect:y,connectCapabilities:b,portFor:_},h}),define("oasis/base_adapter",["oasis/util","oasis/shims","oasis/connect","oasis/message_channel","rsvp","oasis/logger"],function(e,t,n,r,i,o){"use strict";function s(){this._unsupportedCapabilities=[]}var a=e.mustImplement,u=t.addEventListener,c=t.removeEventListener,l=t.a_indexOf,f=t.a_filter,d=(n.connectCapabilities,r.PostMessageMessageChannel);return s.prototype={initializeSandbox:a("BaseAdapter","initializeSandbox"),name:a("BaseAdapter","name"),unsupportedCapabilities:function(){return this._unsupportedCapabilities},addUnsupportedCapability:function(e){this._unsupportedCapabilities.push(e)},filterCapabilities:function(e){var t=this._unsupportedCapabilities;return f.call(e,function(e){return-1===l.call(t,e)})},createChannel:function(e){var t=new d(e);return t.port1.start(),t},environmentPort:function(e,t){return t.port1},sandboxPort:function(e,t){return t.port2},proxyPort:function(e,t){return t},connectSandbox:function(e,t){var n=this;o.log("Sandbox listening for initialization message"),u(e,"message",function r(i){i.data.isOasisInitialization&&(c(e,"message",r),n.initializeOasisSandbox(i,t))}),n.oasisLoaded(t)},initializeOasisSandbox:function(e,t){var n=this;t.configuration.eventCallback(function(){o.log("sandbox: received initialization message."),t.connectCapabilities(e.data.capabilities,e.ports),n.didConnect(t)})},createInitializationMessage:function(e){return{isOasisInitialization:!0,capabilities:e._capabilitiesToConnect}},oasisLoadedMessage:"oasisSandboxLoaded",sandboxInitializedMessage:"oasisSandboxInitialized"},s}),define("oasis/config",[],function(){"use strict";return function(){this.eventCallback=function(e){e()},this.allowSameOrigin=!1,this.reconnect="verify"}}),define("oasis/connect",["oasis/util","oasis/shims","oasis/message_channel","rsvp","oasis/logger","exports"],function(e,t,n,r,i,o){"use strict";function s(e,t,n){var o=e.ports[t];o?(i.log(e.oasisId,"sandbox: found port, setting up '"+t+"'"),n.setupCapability(o),n.promise?n.promise.then(function(){o.start()}).catch(r.rethrow):o.start()):e.receivedPorts?(i.log("No port was sent for capability '"+t+"'"),n.rejectCapability()):(i.log("No port found, saving handler for '"+t+"'"),e.handlers[t]=n)}var a=e.assert,u=t.a_forEach,c=n.PostMessagePort;o.registerHandler=s,o.connect=function(e,t,n){return"object"==typeof e?function(e,t){function n(t,n){return function(r){var i=new t(r);e.consumers[n]=i,i.initialize(r,n)}}function r(e){return function(){t[e].prototype.error()}}for(var i in t)s(e,i,{setupCapability:n(t[i],i),rejectCapability:r(i)})}(this,e.consumers):t?(o=this,a=e,u=t,c=n,i.log("Connecting to '"+a+"' with callback."),void s(o,a,{setupCapability:function(e){u(e)},rejectCapability:function(){c&&c()}})):function(e,t){i.log("Connecting to '"+t+"' with promise.");var n=r.defer();return s(e,t,{promise:n.promise,setupCapability:function(e){return n.resolve(e),n.promise},rejectCapability:function(){n.reject()}}),n.promise}(this,e);var o,a,u,c},o.connectCapabilities=function(e,t){var n=this;u.call(e,function(e,o){var s=n.handlers[e],a=new c(n,t[o]);s&&(i.log("Invoking handler for '"+e+"'"),r.resolve(s.setupCapability(a)).then(function(){a.start()}).catch(r.rethrow)),n.ports[e]=a});for(var o in n.handlers)n.ports[o]||n.handlers[o].rejectCapability();this.receivedPorts=!0},o.portFor=function(e){var t=this.ports[e];return a(t,"You asked for the port for the '"+e+"' capability, but the environment did not provide one."),t}}),define("oasis/events",[],function(){"use strict";function e(){this.listenerArrays={}}var t=Array.prototype.slice;return e.prototype={on:function(e,t){(this.listenerArrays[e]=this.listenerArrays[e]||[]).push(t)},off:function(e,t){var n=this.listenerArrays[e];if(n)for(var r=0;r<n.length;++r)if(n[r]===t){n.splice(r,1);break}},clear:function(e){delete this.listenerArrays[e]},trigger:function(e){var n=this.listenerArrays[e];if(n)for(var r=t.call(arguments,1),i=0;i<n.length;++i)n[i].apply(null,r)}},e}),define("oasis/iframe_adapter",["oasis/util","oasis/shims","rsvp","oasis/logger","oasis/base_adapter"],function(e,t,n,r,i){"use strict";var o=(e.assert,e.extend),s=(t.a_forEach,t.addEventListener),a=t.removeEventListener,u=t.a_map;return o(i,{initializeSandbox:function(e){var t=e.options,i=document.createElement("iframe"),o=["allow-scripts"];e.oasis.configuration.allowSameOrigin&&o.push("allow-same-origin"),t&&t.sandbox&&t.sandbox.popups&&o.push("allow-popups"),i.name=e.options.url+"?uuid="+UUID.generate(),i.sandbox=o.join(" "),i.seamless=!0,t.width?i.width=t.width:t.height&&(i.height=t.height),i.errorHandler=function(t){if(t.data.sandboxException){try{if(t.source!==i.contentWindow)return}catch(e){return}e.onerror(t.data.sandboxException)}},s(window,"message",i.errorHandler),function(e,t){var n,r=document.createElement("iframe");if((e.configuration.allowSameOrigin&&void 0!==r.sandbox||void 0===r.sandbox)&&((n=document.createElement("a")).href=t,!n.host||n.protocol===window.location.protocol&&n.host===window.location.host))throw new Error("Security: iFrames from the same host cannot be sandboxed in older browsers and is disallowed.  For HTML5 browsers supporting the `sandbox` attribute on iframes, you can add the `allow-same-origin` flagonly if you host the sandbox on a separate domain.")}(e.oasis,e.options.url),i.src=e.options.url,r.log("Initializing sandbox "+i.name),e._waitForLoadDeferred().resolve(new n.Promise(function(t,n){i.initializationHandler=function(n){if(n.data===e.adapter.sandboxInitializedMessage){try{if(n.source!==i.contentWindow)return}catch(e){return}a(window,"message",i.initializationHandler),e.oasis.configuration.eventCallback(function(){r.log("container: iframe sandbox has initialized (capabilities connected)"),t(e)})}},s(window,"message",i.initializationHandler)})),e.el=i,i.oasisLoadHandler=function(t){if(t.data===e.adapter.oasisLoadedMessage){try{if(t.source!==i.contentWindow)return}catch(e){return}r.log("container: iframe sandbox has loaded Oasis"),function(e,t){function n(){e.onerror(new Error("Cannot reconnect null origins unless `reconnect` is set to 'any'.  `reconnect: 'verify' requires `allowSameOrigin: true`"))}var r,i;if(e.firstLoad||"any"===e.options.reconnect)return!0;if(e.oasis.configuration.allowSameOrigin&&"null"!==t.origin){if(r=document.createElement("a"),i=document.createElement("a"),r.href=e.options.url,i.href=t.origin,i.protocol===r.protocol&&i.host===r.host)return!0;n()}else n()}(e,t)&&e.createAndTransferCapabilities(),"none"===e.options.reconnect&&a(window,"message",i.oasisLoadHandler)}},s(window,"message",i.oasisLoadHandler)},startSandbox:function(e){(document.head||document.documentElement.getElementsByTagName("head")[0]).appendChild(e.el)},terminateSandbox:function(e){var t=e.el;e.terminated=!0,t.loadHandler&&a(t,"load",t.loadHandler),a(window,"message",t.initializationHandler),a(window,"message",t.oasisLoadHandler),t.parentNode&&(r.log("Terminating sandbox ",e.el.name),t.parentNode.removeChild(t)),e.el=null},connectPorts:function(e,t){var n=u.call(t,function(e){return e.port}),r=this.createInitializationMessage(e);e.terminated||Window.postMessage(e.el.contentWindow,r,"*",n)},connectSandbox:function(e){return i.prototype.connectSandbox.call(this,window,e)},oasisLoaded:function(){window.parent.postMessage(this.oasisLoadedMessage,"*",[])},didConnect:function(){window.parent.postMessage(this.sandboxInitializedMessage,"*",[])},name:function(e){return e.el.name}})}),define("oasis/inline_adapter",["oasis/util","oasis/config","oasis/shims","oasis/xhr","rsvp","oasis/logger","oasis/base_adapter"],function(e,t,n,r,i,o,s){"use strict";var a=(e.assert,e.extend),u=e.noop,c=(t.configuration,n.a_forEach,n.a_map),l=r.xhr;return a(s,{initializeSandbox:function(e){e.el=document.createElement("div"),e.sandboxedOasis=new Oasis,e.sandboxedOasis.sandbox=e,i.async(function(){e.createAndTransferCapabilities()})},startSandbox:function(e){(document.body||document.documentElement.getElementsByTagName("body")[0]).appendChild(e.el)},terminateSandbox:function(e){var t=e.el;t.parentNode&&(o.log("Terminating sandbox ",e.el.name),t.parentNode.removeChild(t)),e.el=null},connectPorts:function(e,t){var n=c.call(t,function(e){return e.port}),r={data:this.createInitializationMessage(e),ports:n};this.connectSandbox(e.sandboxedOasis,r)},fetchResource:function(e,t){var n=this;return l(e,{dataType:"text"},t).then(function(e){return n.wrapResource(e)}).catch(i.rethrow)},wrapResource:function(e){return new Function("oasis",e)},connectSandbox:function(e,t){return this.initializeOasisSandbox(t,e)},oasisLoaded:u,didConnect:function(e){function t(t){return o.log("sandbox: inline sandbox initialized"),t(e),e.sandbox}var n=this;return e.sandbox._waitForLoadDeferred().resolve(new i.Promise(function(r,i){r(n.fetchResource(e.sandbox.options.url,e).then(t))}).catch(i.rethrow))}})}),define("oasis/logger",[],function(){"use strict";function e(){this.enabled=!1}e.prototype={enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},log:function(){if(t.enabled)if("undefined"!=typeof console&&"function"==typeof console.log)console.log.apply(console,arguments);else if("undefined"!=typeof console&&"object"==typeof console.log)try{switch(arguments.length){case 1:console.log(arguments[0]);break;case 2:console.log(arguments[0],arguments[1]);break;default:console.log(arguments[0],arguments[1],arguments[2])}}catch(e){}}};var t=new e;return t}),define("oasis/message_channel",["oasis/util","rsvp","exports"],function(e,t,n){"use strict";function r(e,t){}function i(e){}var o=e.extend,s=e.mustImplement;r.prototype={on:s("OasisPort","on"),all:s("OasisPort","all"),off:s("OasisPort","off"),send:s("OasisPort","send"),start:s("OasisPort","start"),close:s("OasisPort","close"),request:function(e){var n=this.oasis,r=this,i=[].slice.call(arguments,1);return new t.Promise(function(t,o){var s,a=(s=n).oasisId+"-"+s.requestId++,u=function(){r.off("@response:"+e,c),r.off("@errorResponse:"+e,l)},c=function(e){e.requestId===a&&(u(),t(e.data))},l=function(e){e.requestId===a&&(u(),o(e.data))};r.on("@response:"+e,c,r),r.on("@errorResponse:"+e,l,r),r.send("@request:"+e,{requestId:a,args:i})})},onRequest:function(e,n,r){var i=this;this.on("@request:"+e,function(o){var s=o.requestId;(o.args,new t.Promise(function(t,i){var s=n.apply(r,o.args);void 0!==s?t(s):i("@request:"+e+" ["+o.requestId+"] did not return a value.  If you want to return a literal `undefined` return `RSVP.resolve(undefined)`")})).then(function(t){i.send("@response:"+e,{requestId:s,data:t})},function(t){var n=t;t instanceof Error&&(n={message:t.message,stack:t.stack}),i.send("@errorResponse:"+e,{requestId:s,data:n})})})}},i.prototype={start:s("OasisMessageChannel","start")};var a=o(i,{initialize:function(e){this.channel=new MessageChannel,this.port1=new u(e,this.channel.port1),this.port2=new u(e,this.channel.port2)},start:function(){this.port1.start(),this.port2.start()},destroy:function(){this.port1.close(),this.port2.close(),delete this.port1,delete this.port2,delete this.channel}}),u=o(r,{initialize:function(e,t){this.oasis=e,this.port=t,this._callbacks=[]},on:function(e,t,n){function r(r){r.data.type===e&&i.configuration.eventCallback(function(){return t.call(n,r.data.data)})}var i=this.oasis;this._callbacks.push([t,r]),this.port.addEventListener("message",r)},all:function(e,t){var n=this.oasis;this.port.addEventListener("message",function(r){n.configuration.eventCallback(function(){e.call(t,r.data.type,r.data.data)})})},off:function(e,t){for(var n,r=0,i=this._callbacks.length;i>r;r++)n=this._callbacks[r],n[0]===t&&this.port.removeEventListener("message",n[1])},send:function(e,t){this.port.postMessage({type:e,data:t})},start:function(){this.port.start()},close:function(){for(var e,t=0,n=this._callbacks.length;n>t;t++)e=this._callbacks[t],this.port.removeEventListener("message",e[1]);this._callbacks=[],this.port.close()}});n.OasisPort=r,n.PostMessageMessageChannel=a,n.PostMessagePort=u}),define("oasis/sandbox",["oasis/util","oasis/shims","oasis/message_channel","rsvp","oasis/logger"],function(e,t,n,r,i){"use strict";var o=e.assert,s=e.uniq,a=e.reverseMerge,u=t.a_forEach,c=t.a_reduce,l=(t.a_filter,n.OasisPort),f=function(e,t){var n=(t=a(t||{},{reconnect:e.configuration.reconnect})).reconnect;o("none"===n||"verify"===n||"any"===n,"`reconnect` must be one of 'none', 'verify' or 'any'.  '"+n+"' is invalid."),this.connections={},this.wiretaps=[],this.oasis=e;var r=e.packages[t.url],i=t.capabilities;i||(o(r,"You are trying to create a sandbox from an unregistered URL without providing capabilities. Please use Oasis.register to register your package or pass a list of capabilities to createSandbox."),i=r.capabilities),r=r||{},this.adapter=t.adapter||Oasis.adapters.iframe,this._capabilitiesToConnect=this._filterCapabilities(i),this.envPortDefereds={},this.sandboxPortDefereds={},this.channels={},this.capabilities={},this.options=t,this.firstLoad=!0,this.promisePorts(),this.adapter.initializeSandbox(this)};return f.prototype={waitForLoad:function(){return this._waitForLoadDeferred().promise},wiretap:function(e){this.wiretaps.push(e)},connect:function(e){var t=this.envPortDefereds[e].promise;return o(t,"Connect was called on '"+e+"' but no such capability was registered."),t},createAndTransferCapabilities:function(){this.firstLoad||this.promisePorts(),this.createChannels(),this.connectPorts(),this.firstLoad=!1},promisePorts:function(){u.call(this._capabilitiesToConnect,function(e){this.envPortDefereds[e]=r.defer(),this.sandboxPortDefereds[e]=r.defer()},this)},createChannels:function(){var e=this,t=this.options.services||{},n=this.channels;u.call(this._capabilitiesToConnect,function(r){i.log("container: Will create port for '"+r+"'");var o,s,a=t[r];if(a instanceof l)s=this.adapter.proxyPort(this,a),this.capabilities[r]=a;else{o=n[r]=this.adapter.createChannel(e.oasis);var c=this.adapter.environmentPort(this,o),f=this.adapter.sandboxPort(this,o);i.log("container: Wiretapping '"+r+"'"),c.all(function(e,t){u.call(this.wiretaps,function(n){n(r,{type:e,data:t,direction:"received"})})},this),u.call(this.wiretaps,function(e){var t=c.send;c.send=function(n,i){e(r,{type:n,data:i,direction:"sent"}),t.apply(c,arguments)}}),a&&(i.log("container: Creating service for '"+r+"'"),(a=new a(c,this)).initialize(c,r),e.oasis.services.push(a),this.capabilities[r]=a),s=f,this.envPortDefereds[r].resolve(c)}i.log("container: Port created for '"+r+"'"),this.sandboxPortDefereds[r].resolve(s)},this)},destroyChannels:function(){for(var e in this.channels)this.channels[e].destroy(),delete this.channels[e];this.channels=[]},connectPorts:function(){var e=this,t=c.call(this._capabilitiesToConnect,function(t,n){return t.concat(e.sandboxPortDefereds[n].promise)},[]);r.all(t).then(function(t){i.log("container: All "+t.length+" ports created.  Transferring them."),e.adapter.connectPorts(e,t)}).catch(r.rethrow)},start:function(e){this.adapter.startSandbox(this,e)},terminate:function(){if(!this.isTerminated){this.isTerminated=!0,this.adapter.terminateSandbox(this),this.destroyChannels();for(var e=0;e<this.oasis.services.length;e++)this.oasis.services[e].destroy(),delete this.oasis.services[e];this.oasis.services=[]}},onerror:function(e){throw e},name:function(){return this.adapter.name(this)},_filterCapabilities:function(e){return s.call(this.adapter.filterCapabilities(e))},_waitForLoadDeferred:function(){return this._loadDeferred||(this._loadDeferred=r.defer()),this._loadDeferred}},f}),define("oasis/sandbox_init",[],function(){"use strict";return function(){if("undefined"!=typeof window){if(/PhantomJS/.test(navigator.userAgent))return;window.parent&&window.parent!==window&&Oasis.adapters.iframe.connectSandbox(this)}else Oasis.adapters.webworker.connectSandbox(this)}}),define("oasis/service",["oasis/shims"],function(e){"use strict";function t(e,t){function n(e){return function(){return e.apply(o,arguments)}}var r,i,o=this;this.sandbox=t,this.port=e;for(r in this.events)i=this.events[r],e.on(r,n(i));for(r in this.requests)i=this.requests[r],e.onRequest(r,n(i))}var n=e.o_create;return t.prototype={initialize:function(){},error:function(){},destroy:function(){},send:function(){return this.port.send.apply(this.port,arguments)},request:function(){return this.port.request.apply(this.port,arguments)}},t.extend=function e(t){function r(){r.prototype.init&&r.prototype.init.call(this),i.apply(this,arguments)}var i=this;r.extend=e;var o=r.prototype=n(this.prototype);for(var s in t)o[s]=t[s];return r},t}),define("oasis/shims",["exports"],function(e){"use strict";function t(e){return e&&Function.prototype.toString.call(e).indexOf("[native code]")>-1}var n=function(){},r=t(Array.prototype.forEach)?Array.prototype.forEach:function(e){if(void 0===this||null===this)throw new TypeError;var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var r=arguments[1],i=0;n>i;i++)i in t&&e.call(r,t[i],i,t)},i=t(Array.prototype.reduce)?Array.prototype.reduce:function(e,t){if(null===this||void 0===this)throw new TypeError("Array.prototype.reduce called on null or undefined");if("function"!=typeof e)throw new TypeError(e+" is not a function");var n,r=0,i=this.length>>>0,o=!1;for(1<arguments.length&&(n=t,o=!0);i>r;++r)this.hasOwnProperty(r)&&(o?n=e(n,this[r],r,this):(n=this[r],o=!0));if(!o)throw new TypeError("Reduce of empty array with no initial value");return n},o=t(Array.prototype.map)?Array.prototype.map:function(e,t){var n,r,i;if(null==this)throw new TypeError(" this is null or not defined");var o=Object(this),s=o.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(t&&(n=t),r=new Array(s),i=0;s>i;){var a,u;i in o&&(a=o[i],u=e.call(n,a,i,o),r[i]=u),i++}return r},s=t(Array.prototype.indexOf)?Array.prototype.indexOf:function(e){if(null==this)throw new TypeError;var t=Object(this),n=t.length>>>0;if(0===n)return-1;var r=0;if(arguments.length>1&&((r=Number(arguments[1]))!=r?r=0:0!=r&&r!=1/0&&r!=-1/0&&(r=(r>0||-1)*Math.floor(Math.abs(r)))),r>=n)return-1;for(var i=r>=0?r:Math.max(n-Math.abs(r),0);n>i;i++)if(i in t&&t[i]===e)return i;return-1},a=t(Array.prototype.filter)?Array.prototype.filter:function(e){if(!this)throw new TypeError;var t=Object(this);if(t.length,"function"!=typeof e)throw new TypeError;var n=[],r=arguments[1];for(var i in t)t.hasOwnProperty(i)&&e.call(r,t[i],i,t)&&n.push(t[i]);return n};e.o_create=function(e,t){if(n.prototype=e,e=new n,t){n.prototype=e;for(var r in t)n.prototype[r]=t[r].value;e=new n}return n.prototype=null,e},e.addEventListener=function(e,t,n){return e.addEventListener?e.addEventListener(t,n):e.attachEvent?e.attachEvent("on"+t,n):void 0},e.removeEventListener=function(e,t,n){return e.removeEventListener?e.removeEventListener(t,n):e.detachEvent?e.detachEvent("on"+t,n):void 0},e.a_forEach=r,e.a_reduce=i,e.a_map=o,e.a_indexOf=s,e.a_filter=a}),define("oasis/util",["oasis/shims","exports"],function(e,t){"use strict";var n=e.o_create,r=e.a_filter;t.assert=function(e,t){if(!e)throw new Error(t)},t.noop=function(){},t.mustImplement=function(e,t){return function(){throw new Error("Subclasses of "+e+" must implement "+t)}},t.extend=function(e,t){function r(){e.apply(this,arguments),this.initialize&&this.initialize.apply(this,arguments)}r.prototype=n(e.prototype);for(var i in t)t.hasOwnProperty(i)&&(r.prototype[i]=t[i]);return r},t.delegate=function(e,t){return function(){var n=this[e];return n[t].apply(n,arguments)}},t.uniq=function(){var e={};return r.call(this,function(t){var n=!e.hasOwnProperty(t);return e[t]=!0,n})},t.reverseMerge=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(n in e||(e[n]=t[n]));return e}}),define("oasis/version",[],function(){"use strict";return"0.4.0"}),define("oasis/webworker_adapter",["oasis/util","oasis/shims","rsvp","oasis/logger","oasis/base_adapter"],function(e,t,n,r,i){"use strict";var o=(e.assert,e.extend),s=(t.a_forEach,t.addEventListener),a=t.removeEventListener;return o(i,{type:"js",initializeSandbox:function(e){var t=new Worker(e.options.url);t.name=e.options.url+"?uuid="+UUID.generate(),e.worker=t,t.errorHandler=function(t){t.data.sandboxException&&e.onerror(t.data.sandboxException)},s(t,"message",t.errorHandler),e._waitForLoadDeferred().resolve(new n.Promise(function(n,i){t.initializationHandler=function(i){e.oasis.configuration.eventCallback(function(){i.data===e.adapter.sandboxInitializedMessage&&(a(t,"message",t.initializationHandler),r.log("worker sandbox initialized"),n(e))})},s(t,"message",t.initializationHandler)})),t.loadHandler=function(n){e.oasis.configuration.eventCallback(function(){n.data===e.adapter.oasisLoadedMessage&&(a(t,"message",t.loadHandler),r.log("worker sandbox initialized"),e.createAndTransferCapabilities())})},s(t,"message",t.loadHandler)},startSandbox:function(e){},terminateSandbox:function(e){var t=e.worker;a(t,"message",t.loadHandler),a(t,"message",t.initializationHandler),e.worker.terminate()},connectPorts:function(e,t){var n=t.map(function(e){return e.port}),r=this.createInitializationMessage(e);Worker.postMessage(e.worker,r,n)},connectSandbox:function(e){return i.prototype.connectSandbox.call(this,self,e)},name:function(e){return e.worker.name},oasisLoaded:function(){postMessage(this.oasisLoadedMessage,[])},didConnect:function(){postMessage(this.sandboxInitializedMessage,[])}})}),define("oasis/xhr",["oasis/util","rsvp","exports"],function(e,t,n){"use strict";function r(){return 200}function i(e,t){if(t){var n=c.call(arguments,2);n.unshift(e),t.trigger.apply(t,n)}}var o,s,a,u=e.noop,c=Array.prototype.slice,l={},f={"*":"*/*",text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"};try{"withCredentials"in new XMLHttpRequest?(o=XMLHttpRequest,s=function(e,t){var n;e.setRequestHeader("Accepts",(n=t.dataType)&&f[n]?f[n]:f["*"])},a=function(e){return e.status}):"undefined"!=typeof XDomainRequest&&(o=XDomainRequest,s=u,a=r)}catch(e){"undefined"!=typeof XDomainRequest&&(o=XDomainRequest,s=u,a=r)}n.xhr=function(e,n,r){return!r&&this instanceof Oasis&&(r=this),n||(n=l),new t.Promise(function(t,c){var l=new o;l.open("get",e,!0),s(l,n),n.timeout&&(l.timeout=n.timeout),l.onload=function(){i("xhr.load",r,e,n,l);var o=a(l);o>=200&&300>o?t(l.responseText):c(l)},l.onprogress=u,l.ontimeout=function(){i("xhr.timeout",r,e,n,l),c(l)},l.onerror=function(){i("xhr.error",r,e,n,l),c(l)},i("xhr.send",r,e,n,l),l.send()})}}),self.Oasis=requireModule("oasis"),self.oasis=new self.Oasis,self.oasis.autoInitializeSandbox(),window.ProtoEmbed=window.ProtoEmbed||{},ProtoEmbed.initFrame=function(e,t,n,r,i){"string"==typeof e&&(e=document.getElementById(e));var o=e.querySelector("blockquote");o&&e.removeChild(o);var s=Oasis.Service.extend({initialize:function(){var t=this;setTimeout(function(){t.send("get_size")},1e3),this.request("receive",n,r,i).then(function(t){u(e.querySelector("iframe"),t)})},events:{resize_frame:function(t){u(e.querySelector("iframe"),t)}}}),a=oasis.createSandbox({url:t,type:"html",capabilities:["receive"],services:{receive:s}});function u(e,t){void 0!==t&&(e.style.height=t.height+"px",e.style.width=void 0!==typeof t.width&&0!=t.width?t.width:"100%",e.style.visibility="visible")}return a.el.setAttribute("sandbox","allow-popups allow-scripts allow-same-origin allow-presentation allow-top-navigation"),e.appendChild(a.el),e.querySelector("iframe").style.width="100%",e.querySelector("iframe").style.height="auto",e.querySelector("iframe").style.borderWidth="0px",e.querySelector("iframe").style.visibility="hidden",{sandbox:a}};